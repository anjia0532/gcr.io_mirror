name: gcr.io_mirror

on: 
  issues:
    types: [opened]
  label:
    types: [created]
  workflow_dispatch:


jobs:
  build:
    runs-on: ubuntu-latest
    if: contains(github.event.issue.labels.*.name, 'porter')
    steps:
      - name: æ£€å‡ºä»£ç 
        uses: actions/checkout@v3

      - name: è®¾ç½® golang ç¯å¢ƒ
        uses: actions/setup-go@v3
        with:
          go-version: 1.18
          check-latest: true
          cache: true

      - name: è¿è¡Œ go ä»£ç 
        run: go run main.go --github.token=${{ secrets.GITHUB_TOKEN }} --github.user=${{ github.repository_owner }} --github.repo=${{ github.event.repository.name }} --docker.registry=${{ secrets.DOCKER_REGISTRY }} --docker.namespace=${{ secrets.DOCKER_NAMESPACE }} --docker.user=${{ secrets.DOCKER_USER }} --docker.secret=${{ secrets.DOCKER_PASSWORD }} --github.run_id=${{ github.run_id }}

  auto_close_issues:
    runs-on: ubuntu-latest
    steps:
      - name: æ£€å‡ºä»£ç 
        uses: actions/checkout@v3
      - name: è‡ªåŠ¨å…³é—­ä¸é€šè¿‡issuesæ¨¡æ¿åˆ›å»ºçš„issues
        uses: lucasbento/auto-close-issues@v1.0.2
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          issue-close-message: "@${issue.user.login}: ä¸æ˜¯è¯´äº†åˆ«çæå˜›! :wave:\n\nè®©å¯¹äºä¸æŒ‰ç…§ issues æ¨¡æ¿æ¥çš„ä¸€å¾‹è‡ªåŠ¨å…³é—­issues."
          closed-issues-label: "ğŸ™ Not following issue template" # optional property